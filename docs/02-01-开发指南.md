# TestWings 开发指南

> 完整的开发指南，从环境搭建到快速开始，帮助你从零开始开发TestWings

## 一、为什么这个项目是可行的？

### 1.1 你的优势

✅ **软件自动化测试经验**：这是核心能力，你已经理解测试的本质
✅ **测试思维**：知道如何设计测试用例、验证结果
✅ **问题解决能力**：这是最重要的技能

### 1.2 技术栈并不复杂

- **Android 开发**：主要是调用系统API，逻辑相对简单
- **AI 模型**：我们使用现成的模型和框架，不需要从零训练
- **架构设计**：已经设计好了，你只需要实现

---

## 二、环境搭建

### 2.1 工具定位

#### Android Studio
**定位**：Google 官方提供的专门用于 Android 开发的完整 IDE（集成开发环境）

**包含的功能**：
- ✅ **代码编辑器**：编写 Kotlin/Java 代码
- ✅ **项目创建和管理**：创建 Android 项目、管理依赖
- ✅ **Android SDK 管理**：下载和管理不同版本的 Android SDK
- ✅ **构建系统**：Gradle 构建工具集成
- ✅ **调试工具**：断点调试、日志查看、性能分析
- ✅ **设备管理**：连接真机、启动模拟器
- ✅ **UI 设计器**：可视化设计界面（Layout Editor）
- ✅ **APK 打包**：编译和打包应用

**类比**：就像专门为 Android 开发定制的"瑞士军刀"，包含了 Android 开发所需的所有工具

#### Cursor
**定位**：基于 AI 的代码编辑器（类似 VS Code）

**包含的功能**：
- ✅ **代码编辑器**：编写代码
- ✅ **AI 辅助**：代码生成、问题解答
- ✅ **Git 集成**：版本控制

**不包含的功能**：
- ❌ Android SDK 管理
- ❌ Android 项目创建向导
- ❌ 设备连接和调试
- ❌ APK 打包工具

**推荐方案**：
- **主要使用 Android Studio**：进行完整的开发流程
- **可选组合**：熟悉后可以 Android Studio + Cursor 组合使用（Android Studio 管理项目，Cursor 编写代码）

### 2.2 为什么 Android 开发需要 Android Studio？

**Android 开发不只是写代码，还需要：**

1. **Android SDK**：包含 Android 系统的 API，不同版本的 SDK
2. **构建系统（Gradle）**：编译代码、打包资源、生成 APK、管理依赖
3. **调试工具**：连接设备、查看日志、断点调试、性能分析
4. **设备管理**：启动模拟器、连接真机、安装应用

**Android Studio 提供了所有这些工具！**

### 2.3 安装步骤

1. **下载 Android Studio**
   - 访问：https://developer.android.com/studio
   - 下载最新版本

2. **安装 Android Studio**
   - 运行安装程序
   - 选择标准安装（包含 Android SDK、模拟器等）

3. **配置 Android SDK**
   - 打开 Android Studio
   - 进入 Settings → Appearance & Behavior → System Settings → Android SDK
   - 安装 Android SDK Platform（API 29 或更高）
   - 安装 Android SDK Build-Tools

4. **验证安装**
   - 创建新项目
   - 运行 "Hello World"
   - 连接真机或启动模拟器测试

---

## 三、从零开始学习路径

### Phase 0: 基础准备（1-2周）

#### 3.1 Android 开发基础

**目标**：能够创建简单的 Android APP

**学习内容**：
1. **Android Studio 安装和配置**
   - 下载安装 Android Studio（必需！）
   - 配置 Android SDK
   - 创建第一个 Hello World 项目

2. **Kotlin 基础语法**（推荐使用 Kotlin，比 Java 简单）
   - 变量和类型
   - 函数
   - 类和对象
   - 协程基础（用于异步操作）

**学习资源**：
- [Android 官方教程](https://developer.android.com/courses)
- [Kotlin 官方文档](https://kotlinlang.org/docs/home.html)
- [菜鸟教程 - Kotlin](https://www.runoob.com/kotlin/kotlin-tutorial.html)

**实践任务**：
- [ ] 创建一个简单的 Android APP
- [ ] 实现一个按钮点击事件
- [ ] 显示一个列表

#### 3.2 Android 核心概念

**目标**：理解 Android 的核心组件

**学习内容**：
1. **Activity**：界面
2. **Service**：后台服务
3. **MediaProjection**：屏幕捕获（核心！）
4. **权限管理**：如何申请和使用权限

**实践任务**：
- [ ] 创建一个 Service
- [ ] 申请并获取存储权限
- [ ] 了解 MediaProjection 的基本用法

---

### Phase 1: MVP 版本（2-3周）

**目标**：实现最基础的功能，验证可行性

#### 3.3 屏幕捕获功能

**难度**：⭐⭐
**时间**：3-5天

**任务清单**：
- [ ] 申请屏幕捕获权限（MediaProjection）
- [ ] 实现屏幕截图功能
- [ ] 保存截图到本地
- [ ] 在界面上显示截图

**详细步骤**：参见"快速开始"章节

#### 3.4 OCR 文字识别（降级方案）

**难度**：⭐⭐
**时间**：3-5天

**任务清单**：
- [ ] 选择 OCR 库（ML Kit Text Recognition）
- [ ] 集成 OCR 库到项目
- [ ] 实现截图 OCR 识别功能
- [ ] 提取文字内容和位置信息
- [ ] 显示识别结果

**注意**：OCR仅作为降级方案，后续将集成Vision-Language模型作为主要能力。

#### 3.5 基础操作执行

**难度**：⭐⭐⭐
**时间**：5-7天

**任务清单**：
- [ ] 实现点击操作（纯坐标操作）
- [ ] 实现滑动操作
- [ ] 实现输入操作
- [ ] 实现系统按键（返回键等）

**注意**：采用纯视觉AI方案，不依赖AccessibilityService，所有操作基于坐标。

---

### Phase 2: AI增强（3-4周）

**目标**：集成AI模型，实现智能能力

#### 3.6 Vision-Language模型集成

**难度**：⭐⭐⭐⭐
**时间**：10-15天

**任务清单**：
- [ ] 选择VL模型（Qwen-VL-Chat，INT8量化）
- [ ] 集成VL模型到项目
- [ ] 实现屏幕理解功能
- [ ] 识别所有UI元素（文字、按钮、输入框等）
- [ ] 提取元素坐标和语义描述
- [ ] 优化模型推理性能

#### 3.7 LLM集成（用例理解和操作规划）

**难度**：⭐⭐⭐⭐
**时间**：10-15天

**任务清单**：
- [ ] 选择LLM模型（Qwen-7B-Chat，INT8量化）
- [ ] 集成LLM到项目
- [ ] 实现用例理解功能
- [ ] 实现操作规划功能
- [ ] AI自主决策能力

---

## 四、快速开始

### 4.1 第一个功能：屏幕捕获

**目标**：实现一个能够捕获手机屏幕并保存截图的功能

**前置条件**：
- ✅ Android Studio 已安装
- ✅ 创建了第一个 Android 项目
- ✅ 能够运行 "Hello World"
- ✅ 手机已连接并开启 USB 调试

**步骤详解**：

#### 步骤 1：创建项目结构

**在 Android Studio 中：**
1. 确保项目使用 Kotlin
2. 最低 SDK：API 29 (Android 10)
3. 目标 SDK：API 33 或更高

#### 步骤 2：添加权限

**在 `AndroidManifest.xml` 中添加：**

```xml
<!-- 存储权限 -->
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />

<!-- 前台服务权限 -->
<uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
```

#### 步骤 3：创建屏幕捕获工具类

**创建文件：`app/src/main/java/com/testwings/utils/ScreenCapture.kt`**

```kotlin
package com.testwings.utils

import android.content.Context
import android.graphics.Bitmap
import android.os.Environment
import java.io.File
import java.io.FileOutputStream
import java.text.SimpleDateFormat
import java.util.*

class ScreenCapture(private val context: Context) {
    
    /**
     * 保存 Bitmap 到文件
     */
    fun saveBitmap(bitmap: Bitmap, filename: String = "screenshot_${getTimestamp()}.png"): String? {
        return try {
            // 获取保存路径
            val picturesDir = Environment.getExternalStoragePublicDirectory(
                Environment.DIRECTORY_PICTURES
            )
            val testWingsDir = File(picturesDir, "TestWings")
            if (!testWingsDir.exists()) {
                testWingsDir.mkdirs()
            }
            
            val file = File(testWingsDir, filename)
            
            // 保存文件
            FileOutputStream(file).use { out ->
                bitmap.compress(Bitmap.CompressFormat.PNG, 100, out)
            }
            
            file.absolutePath
        } catch (e: Exception) {
            e.printStackTrace()
            null
        }
    }
    
    /**
     * 获取时间戳
     */
    private fun getTimestamp(): String {
        val sdf = SimpleDateFormat("yyyyMMdd_HHmmss", Locale.getDefault())
        return sdf.format(Date())
    }
}
```

#### 步骤 4：在主界面中集成

**在 `MainActivity.kt` 中：**
- 添加"捕获屏幕"按钮
- 实现点击事件
- 调用屏幕捕获功能
- 显示截图

**详细代码**：参见项目代码 `MainActivity.kt`

---

## 五、Android开发方案

### 5.1 开发策略

**采用 Android 原生开发：**
- 使用 Android SDK 进行开发
- 目标 API Level: Android 10 (API 29) 或更高
- 兼容 HarmonyOS 4.2.0（通过 Android 兼容层）

### 5.2 核心 API

**Android 标准 API：**
- `MediaProjection`：用于屏幕捕获
- `WindowManager`：用于悬浮窗显示（可选）

**注意**：采用纯视觉AI方案，不依赖AccessibilityService。

### 5.3 开发工具

- **IDE**：Android Studio（最新版本）
- **语言**：Kotlin（推荐）或 Java
- **构建工具**：Gradle
- **调试工具**：ADB（Android Debug Bridge）

### 5.4 APP 架构设计

```
TestWings APP
├── 主界面（测试用例管理、执行控制）
├── 后台服务（屏幕捕获服务）
│   ├── 屏幕监控服务
│   ├── 操作执行服务
│   └── 结果记录服务
├── AI 引擎模块（完全本地部署）
│   ├── Vision-Language模型（主要能力）
│   ├── LLM模型（用例理解、操作规划）
│   └── OCR模型（降级方案，可选）
└── 数据存储
    ├── 测试用例数据库（SQLite）
    ├── 执行结果存储
    └── 截图缓存
```

### 5.5 代码结构设计

```
app/
├── src/
│   ├── main/
│   │   ├── java/com/testwings/
│   │   │   ├── ui/                    # UI 界面
│   │   │   │   ├── MainActivity.kt
│   │   │   │   └── TestCaseManager.kt
│   │   │   ├── service/               # 后台服务
│   │   │   │   └── ScreenCaptureService.kt
│   │   │   ├── ai/                    # AI 引擎
│   │   │   │   ├── vision_language/
│   │   │   │   │   └── VLModelManager.kt
│   │   │   │   ├── llm/
│   │   │   │   │   └── LLMManager.kt
│   │   │   │   └── ocr/
│   │   │   │       └── OcrRecognizer.kt
│   │   │   ├── device/                # 设备控制
│   │   │   │   ├── ScreenCapture.kt
│   │   │   │   ├── ElementLocator.kt
│   │   │   │   └── DeviceController.kt
│   │   │   ├── executor/              # 测试执行
│   │   │   │   └── TestExecutor.kt
│   │   │   ├── database/              # 数据存储
│   │   │   │   └── TestCaseDatabase.kt
│   │   │   └── utils/                 # 工具类
│   │   │       └── SemanticMatcher.kt
│   │   ├── assets/
│   │   │   └── models/                # AI 模型文件
│   │   └── res/
│   └── test/                          # 测试代码
└── build.gradle
```

### 5.6 权限要求

**Android 所需权限：**

```xml
<!-- AndroidManifest.xml -->
<uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW" />
<uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />

<!-- 屏幕捕获权限 -->
<uses-permission android:name="android.permission.CAPTURE_VIDEO_OUTPUT" />
```

**用户需要手动授权的权限**：
1. **屏幕捕获权限**（MediaProjection）：首次使用时授权
2. **存储权限**：用于保存测试结果和截图

**注意**：采用纯视觉AI方案，不依赖AccessibilityService权限。

### 5.7 硬件配置要求

**完全本地部署所需配置：**
- **内存**：8GB RAM（最低），12GB+ 推荐
- **存储**：64GB+（用于存储模型文件和测试数据）
- **处理器**：支持 NPU 的芯片（如麒麟 990/9000、骁龙 8 Gen 2+）推荐

---

## 六、开发规范

### 6.1 代码风格

- **语言**：优先使用 Kotlin
- **命名**：使用单引号（字符串）
- **代码风格**：统一代码风格，参考 Android 官方规范

### 6.2 项目结构

- **模块化**：按功能模块组织代码
- **分层清晰**：UI层、业务层、数据层分离
- **文档完善**：关键代码添加注释

### 6.3 测试策略

1. **单元测试**：核心功能模块测试
2. **集成测试**：模块间协作测试
3. **真机测试**：在真实设备上测试
4. **兼容性测试**：在不同 Android 版本上测试

---

## 七、常见问题

### 7.1 环境问题

**Q: Android Studio 安装失败？**
- A: 检查系统要求，确保有足够的磁盘空间和内存

**Q: SDK 下载失败？**
- A: 检查网络连接，可能需要配置代理

### 7.2 开发问题

**Q: 无法连接设备？**
- A: 检查 USB 调试是否开启，检查驱动是否安装

**Q: 权限申请失败？**
- A: 检查 AndroidManifest.xml 中的权限声明，检查运行时权限申请代码

### 7.3 性能问题

**Q: 应用运行缓慢？**
- A: 检查是否有内存泄漏，优化模型推理性能

---

## 八、学习资源

### 8.1 官方文档

- [Android 官方文档](https://developer.android.com/docs)
- [Kotlin 官方文档](https://kotlinlang.org/docs/home.html)
- [Jetpack Compose 文档](https://developer.android.com/jetpack/compose)

### 8.2 教程资源

- [Android 官方教程](https://developer.android.com/courses)
- [菜鸟教程 - Android](https://www.runoob.com/android/android-tutorial.html)
- [菜鸟教程 - Kotlin](https://www.runoob.com/kotlin/kotlin-tutorial.html)

### 8.3 项目相关文档

- `01-01-架构设计.md` - 系统架构设计
- `01-02-纯视觉AI技术实现方案.md` - 技术实现细节
- `01-03-模型部署方案.md` - 模型部署方案
- `02-02-开发路线图.md` - **唯一总体规划文档**，开发进度和计划

---

## 九、下一步

完成环境搭建和基础学习后，可以：

1. **开始实现第一个功能**：屏幕捕获（参见"快速开始"章节）
2. **阅读架构设计文档**：理解整体架构
3. **阅读技术实现方案**：了解技术细节
4. **查看开发路线图**：参见 `02-02-开发路线图.md` - 了解当前进度和下一步计划

**祝你开发顺利！** 🚀

