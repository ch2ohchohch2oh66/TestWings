# 预处理截图规范指南

> 本文档为测试工程师提供预处理截图的准备指南

## 一、快速开始

### 1.1 基本流程

1. **准备截图**：打开APP，导航到目标页面，截图
2. **命名文件**：按命名规范命名截图文件
3. **创建元数据**：创建JSON元数据文件
4. **填写信息**：填写页面名称、场景名称等元数据
5. **提交预处理**：提交截图和元数据，等待预处理完成

---

## 二、命名规范

### 2.1 文件命名格式

```
{app_name}_{page_name}_{scenario_name}_{version}.png
```

### 2.2 命名示例

**基础页面**：
```
wechat_main_home_v1.0.png          # 微信主界面
meeting_join_room_v1.0.png          # 会议加入房间页面
```

**多场景页面**：
```
wechat_chat_list_default_v1.0.png   # 微信聊天列表（默认场景）
wechat_chat_list_empty_v1.0.png     # 微信聊天列表（空列表场景）
wechat_chat_list_search_v1.0.png    # 微信聊天列表（搜索场景）
```

**版本更新**：
```
wechat_main_home_v1.0.png           # 版本1.0
wechat_main_home_v2.0.png           # 版本2.0（页面更新后）
```

### 2.3 命名规则

| 字段 | 说明 | 示例 |
|------|------|------|
| `app_name` | 应用名称（小写，下划线分隔） | `wechat`, `meeting` |
| `page_name` | 页面名称（小写，下划线分隔） | `main`, `chat_list`, `join_room` |
| `scenario_name` | 场景名称（可选，小写，下划线分隔） | `default`, `empty`, `error` |
| `version` | 版本号 | `v1.0`, `v2.0` |

**注意事项**：
- 使用小写字母
- 单词间用下划线分隔
- 场景名称可选，但建议提供（如有多个场景）
- 版本号格式：`v{主版本号}.{次版本号}`

---

## 三、元数据规范

### 3.1 元数据文件

**文件命名**：与截图文件同名，扩展名为`.json`

**示例**：
- 截图：`wechat_main_home_v1.0.png`
- 元数据：`wechat_main_home_v1.0.json`

### 3.2 必需信息

```json
{
  "app_name": "wechat",
  "app_display_name": "微信",
  "page_name": "main",
  "page_display_name": "主界面",
  "scenario_name": "home",
  "scenario_display_name": "默认首页",
  "version": "1.0",
  "description": "微信主界面，包含底部导航栏和聊天列表",
  "key_features": {
    "key_texts": ["微信", "聊天", "发现", "我"],
    "key_elements": ["底部导航栏", "聊天列表", "搜索框"]
  },
  "screenshot_type": "static",
  "created_at": "2024-01-01T10:00:00Z",
  "created_by": "测试工程师姓名"
}
```

### 3.3 字段说明

| 字段 | 类型 | 必需 | 说明 |
|------|------|------|------|
| `app_name` | string | ✅ | 应用名称（小写，下划线分隔） |
| `app_display_name` | string | ✅ | 应用显示名称（中文） |
| `page_name` | string | ✅ | 页面名称（小写，下划线分隔） |
| `page_display_name` | string | ✅ | 页面显示名称（中文，用于用例匹配） |
| `scenario_name` | string | ❌ | 场景名称（小写，下划线分隔） |
| `scenario_display_name` | string | ❌ | 场景显示名称（中文，用于用例匹配） |
| `version` | string | ✅ | 版本号 |
| `description` | string | ✅ | 页面描述 |
| `key_features` | object | ✅ | 关键特征（用于匹配） |
| `screenshot_type` | string | ✅ | 截图类型：`static` 或 `scroll` |
| `created_at` | string | ✅ | 创建时间（ISO 8601格式） |
| `created_by` | string | ✅ | 创建者姓名 |

### 3.4 可选信息

```json
{
  "tags": ["首页", "导航", "常用页面"],
  "related_pages": ["wechat_chat_detail", "wechat_discover"],
  "notes": "此页面在登录后显示",
  "scroll_direction": "vertical"  // 仅当 screenshot_type = "scroll" 时使用
}
```

---

## 四、用例匹配

### 4.1 用例中的页面引用

**自然语言用例**：
```
打开微信APP，进入主界面，点击"聊天"按钮
```

**结构化用例**（JSON）：
```json
{
  "steps": [
    {
      "action": "navigate",
      "page": "主界面",  // 对应 page_display_name
      "scenario": "默认首页"  // 对应 scenario_display_name（可选）
    }
  ]
}
```

### 4.2 匹配规则

**匹配优先级**：
1. **精确匹配**：`page_display_name` + `scenario_display_name` 完全匹配
2. **页面匹配**：仅 `page_display_name` 匹配
3. **语义匹配**：AI理解用例描述，匹配预处理截图
4. **特征匹配**：比较关键特征（key_texts、key_elements）

### 4.3 命名一致性建议

**建议**：
- 用例中的页面名称使用 `page_display_name`
- 场景名称使用 `scenario_display_name`（如有）
- 保持命名一致性，便于匹配

**示例**：
- 预处理截图：`page_display_name = "主界面"`
- 用例中：`"page": "主界面"` ✅ 匹配成功

---

## 五、滚动截图处理

### 5.1 何时需要滚动截图

**需要滚动截图的情况**：
- 页面内容超出屏幕范围
- 需要识别滚动区域内的元素
- 需要完整页面信息

### 5.2 滚动截图方法

**方法1：手动滚动截图**
1. 从页面顶部开始截图
2. 向下滚动，继续截图
3. 拼接多张截图

**方法2：使用工具自动滚动**
1. 使用自动化工具自动滚动
2. 自动拼接截图

### 5.3 元数据配置

**滚动截图元数据**：
```json
{
  "screenshot_type": "scroll",
  "scroll_direction": "vertical",  // vertical: 垂直滚动, horizontal: 水平滚动
  "description": "微信聊天列表页面（完整滚动截图）"
}
```

---

## 六、检查清单

### 6.1 截图准备检查

- ✅ 截图清晰，文字和元素可见
- ✅ 如果是滚动页面，已进行滚动截图
- ✅ 文件命名符合规范
- ✅ 文件命名与元数据中的信息一致

### 6.2 元数据填写检查

- ✅ 必需信息完整
- ✅ `page_display_name` 与用例中的页面名称一致
- ✅ `scenario_display_name` 清晰明确（如有多个场景）
- ✅ `key_features` 信息准确
- ✅ `screenshot_type` 正确（static 或 scroll）

### 6.3 用例编写检查

- ✅ 用例中的页面名称使用 `page_display_name`
- ✅ 场景名称使用 `scenario_display_name`（如有）
- ✅ 命名与预处理截图保持一致

---

## 七、常见问题

### 7.1 页面更新后如何处理？

**处理方式**：
1. 更新版本号（如 v1.0 → v2.0）
2. 重新截图
3. 更新元数据
4. 重新预处理

### 7.2 多个场景如何处理？

**处理方式**：
1. 为每个场景创建独立的截图
2. 使用 `scenario_name` 区分场景
3. 用例中通过 `scenario` 字段指定场景

**示例**：
- `wechat_chat_list_default_v1.0.png` - 默认场景
- `wechat_chat_list_empty_v1.0.png` - 空列表场景

### 7.3 用例匹配失败怎么办？

**排查步骤**：
1. 检查用例中的页面名称是否与 `page_display_name` 一致
2. 检查场景名称是否与 `scenario_display_name` 一致
3. 检查预处理截图是否存在
4. 检查版本号是否匹配

---

## 八、最佳实践

### 8.1 命名建议

- **清晰明确**：页面名称和场景名称要清晰明确
- **一致性**：保持用例和预处理截图的命名一致
- **版本管理**：页面更新时及时更新版本号

### 8.2 元数据建议

- **关键特征准确**：`key_features` 要准确，便于匹配
- **描述详细**：`description` 要详细，便于理解
- **标签使用**：使用 `tags` 便于分类和管理

### 8.3 用例编写建议

- **使用显示名称**：用例中使用 `page_display_name` 和 `scenario_display_name`
- **保持一致性**：用例中的命名与预处理截图保持一致
- **场景明确**：如有多个场景，明确指定场景名称

---

## 九、示例

### 9.1 完整示例

**截图文件**：`wechat_main_home_v1.0.png`

**元数据文件**：`wechat_main_home_v1.0.json`
```json
{
  "app_name": "wechat",
  "app_display_name": "微信",
  "page_name": "main",
  "page_display_name": "主界面",
  "scenario_name": "home",
  "scenario_display_name": "默认首页",
  "version": "1.0",
  "description": "微信主界面，包含底部导航栏（聊天、发现、我）和聊天列表",
  "key_features": {
    "key_texts": ["微信", "聊天", "发现", "我"],
    "key_elements": ["底部导航栏", "聊天列表", "搜索框"]
  },
  "screenshot_type": "static",
  "created_at": "2024-01-01T10:00:00Z",
  "created_by": "张三",
  "tags": ["首页", "导航", "常用页面"]
}
```

**用例示例**：
```json
{
  "name": "微信主界面测试",
  "steps": [
    {
      "action": "open_app",
      "app": "微信"
    },
    {
      "action": "navigate",
      "page": "主界面",
      "scenario": "默认首页"
    },
    {
      "action": "click",
      "target": "聊天"
    }
  ]
}
```

**匹配结果**：✅ 匹配成功，使用预处理结果

---

## 十、总结

预处理截图规范的核心要点：

1. **命名规范**：`{app_name}_{page_name}_{scenario_name}_{version}.png`
2. **元数据完整**：必需信息完整，关键特征准确
3. **命名一致性**：用例中的页面名称与 `page_display_name` 一致
4. **版本管理**：页面更新时及时更新版本号
5. **场景区分**：多个场景使用 `scenario_name` 区分

遵循这些规范，可以确保预处理截图与用例正确匹配，提升测试执行效率和准确率。

