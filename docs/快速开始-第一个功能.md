# å¿«é€Ÿå¼€å§‹ - å®ç°ç¬¬ä¸€ä¸ªåŠŸèƒ½ï¼šå±å¹•æ•è·

> è¿™æ˜¯ä½ çš„ç¬¬ä¸€ä¸ªå®æˆ˜ä»»åŠ¡ï¼å®Œæˆè¿™ä¸ªåŠŸèƒ½ï¼Œä½ å°±è¿ˆå‡ºäº†ç¬¬ä¸€æ­¥ï¼

## ä¸€ã€ç›®æ ‡

å®ç°ä¸€ä¸ªèƒ½å¤Ÿæ•è·æ‰‹æœºå±å¹•å¹¶ä¿å­˜æˆªå›¾çš„åŠŸèƒ½ã€‚

## äºŒã€å‰ç½®æ¡ä»¶

- âœ… Android Studio å·²å®‰è£…
- âœ… åˆ›å»ºäº†ç¬¬ä¸€ä¸ª Android é¡¹ç›®
- âœ… èƒ½å¤Ÿè¿è¡Œ "Hello World"
- âœ… æ‰‹æœºå·²è¿æ¥å¹¶å¼€å¯ USB è°ƒè¯•

## ä¸‰ã€æ­¥éª¤è¯¦è§£

### æ­¥éª¤ 1ï¼šåˆ›å»ºé¡¹ç›®ç»“æ„

**åœ¨ Android Studio ä¸­ï¼š**

1. ç¡®ä¿é¡¹ç›®ä½¿ç”¨ Kotlin
2. æœ€ä½ SDKï¼šAPI 29 (Android 10)
3. ç›®æ ‡ SDKï¼šAPI 33 æˆ–æ›´é«˜

### æ­¥éª¤ 2ï¼šæ·»åŠ æƒé™

**åœ¨ `AndroidManifest.xml` ä¸­æ·»åŠ ï¼š**

```xml
<!-- å­˜å‚¨æƒé™ -->
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />

<!-- Android 10+ éœ€è¦è¿™ä¸ª -->
<uses-permission android:name="android.permission.MANAGE_EXTERNAL_STORAGE"
    tools:ignore="ScopedStorage" />
```

### æ­¥éª¤ 3ï¼šåˆ›å»ºå±å¹•æ•è·å·¥å…·ç±»

**åˆ›å»ºæ–‡ä»¶ï¼š`app/src/main/java/com/testwings/utils/ScreenCapture.kt`**

```kotlin
package com.testwings.utils

import android.content.Context
import android.graphics.Bitmap
import android.media.projection.MediaProjection
import android.media.projection.MediaProjectionManager
import android.os.Build
import android.os.Environment
import java.io.File
import java.io.FileOutputStream
import java.text.SimpleDateFormat
import java.util.*

class ScreenCapture(private val context: Context) {
    
    /**
     * ä¿å­˜ Bitmap åˆ°æ–‡ä»¶
     */
    fun saveBitmap(bitmap: Bitmap, filename: String = "screenshot_${getTimestamp()}.png"): String? {
        return try {
            // è·å–ä¿å­˜è·¯å¾„
            val picturesDir = Environment.getExternalStoragePublicDirectory(
                Environment.DIRECTORY_PICTURES
            )
            val testWingsDir = File(picturesDir, "TestWings")
            if (!testWingsDir.exists()) {
                testWingsDir.mkdirs()
            }
            
            val file = File(testWingsDir, filename)
            
            // ä¿å­˜æ–‡ä»¶
            FileOutputStream(file).use { out ->
                bitmap.compress(Bitmap.CompressFormat.PNG, 100, out)
            }
            
            file.absolutePath
        } catch (e: Exception) {
            e.printStackTrace()
            null
        }
    }
    
    /**
     * è·å–æ—¶é—´æˆ³
     */
    private fun getTimestamp(): String {
        val sdf = SimpleDateFormat("yyyyMMdd_HHmmss", Locale.getDefault())
        return sdf.format(Date())
    }
}
```

### æ­¥éª¤ 4ï¼šåˆ›å»ºä¸»ç•Œé¢

**ä¿®æ”¹ `MainActivity.kt`ï¼š**

```kotlin
package com.testwings

import android.Manifest
import android.content.Intent
import android.content.pm.PackageManager
import android.graphics.Bitmap
import android.media.projection.MediaProjectionManager
import android.os.Build
import android.os.Bundle
import android.widget.Button
import android.widget.ImageView
import android.widget.TextView
import android.widget.Toast
import androidx.appcompat.app.AppCompatActivity
import androidx.core.app.ActivityCompat
import androidx.core.content.ContextCompat
import com.testwings.utils.ScreenCapture

class MainActivity : AppCompatActivity() {
    
    private lateinit var btnCapture: Button
    private lateinit var ivScreenshot: ImageView
    private lateinit var tvStatus: TextView
    private lateinit var screenCapture: ScreenCapture
    
    private val REQUEST_CODE_SCREEN_CAPTURE = 1001
    private val REQUEST_CODE_STORAGE_PERMISSION = 1002
    
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        
        // åˆå§‹åŒ–
        screenCapture = ScreenCapture(this)
        initViews()
        checkPermissions()
    }
    
    private fun initViews() {
        btnCapture = findViewById(R.id.btnCapture)
        ivScreenshot = findViewById(R.id.ivScreenshot)
        tvStatus = findViewById(R.id.tvStatus)
        
        btnCapture.setOnClickListener {
            requestScreenCapture()
        }
    }
    
    /**
     * æ£€æŸ¥æƒé™
     */
    private fun checkPermissions() {
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {
            if (ContextCompat.checkSelfPermission(
                    this,
                    Manifest.permission.WRITE_EXTERNAL_STORAGE
                ) != PackageManager.PERMISSION_GRANTED
            ) {
                ActivityCompat.requestPermissions(
                    this,
                    arrayOf(Manifest.permission.WRITE_EXTERNAL_STORAGE),
                    REQUEST_CODE_STORAGE_PERMISSION
                )
            }
        }
    }
    
    /**
     * è¯·æ±‚å±å¹•æ•è·æƒé™
     */
    private fun requestScreenCapture() {
        val mediaProjectionManager = getSystemService(MEDIA_PROJECTION_SERVICE) as MediaProjectionManager
        val intent = mediaProjectionManager.createScreenCaptureIntent()
        startActivityForResult(intent, REQUEST_CODE_SCREEN_CAPTURE)
    }
    
    /**
     * å¤„ç†æƒé™è¯·æ±‚ç»“æœ
     */
    override fun onRequestPermissionsResult(
        requestCode: Int,
        permissions: Array<out String>,
        grantResults: IntArray
    ) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults)
        if (requestCode == REQUEST_CODE_STORAGE_PERMISSION) {
            if (grantResults.isNotEmpty() && grantResults[0] == PackageManager.PERMISSION_GRANTED) {
                Toast.makeText(this, "å­˜å‚¨æƒé™å·²æˆäºˆ", Toast.LENGTH_SHORT).show()
            } else {
                Toast.makeText(this, "éœ€è¦å­˜å‚¨æƒé™æ‰èƒ½ä¿å­˜æˆªå›¾", Toast.LENGTH_SHORT).show()
            }
        }
    }
    
    /**
     * å¤„ç†å±å¹•æ•è·è¯·æ±‚ç»“æœ
     */
    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
        super.onActivityResult(requestCode, resultCode, data)
        if (requestCode == REQUEST_CODE_SCREEN_CAPTURE) {
            if (resultCode == RESULT_OK && data != null) {
                // è¿™é‡Œæš‚æ—¶ä½¿ç”¨ç®€å•çš„æ–¹æ³•
                // å®Œæ•´çš„å±å¹•æ•è·éœ€è¦ MediaProjectionï¼Œæˆ‘ä»¬ä¸‹ä¸€æ­¥å®ç°
                tvStatus.text = "å±å¹•æ•è·æƒé™å·²æˆäºˆï¼Œå‡†å¤‡æ•è·å±å¹•..."
                Toast.makeText(this, "æƒé™å·²æˆäºˆï¼Œç‚¹å‡»æŒ‰é’®å¼€å§‹æ•è·", Toast.LENGTH_SHORT).show()
            } else {
                Toast.makeText(this, "å±å¹•æ•è·æƒé™è¢«æ‹’ç»", Toast.LENGTH_SHORT).show()
            }
        }
    }
}
```

### æ­¥éª¤ 5ï¼šåˆ›å»ºå¸ƒå±€æ–‡ä»¶

**åˆ›å»º/ä¿®æ”¹ `res/layout/activity_main.xml`ï¼š**

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:padding="16dp">

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="TestWings - å±å¹•æ•è·æµ‹è¯•"
        android:textSize="20sp"
        android:textStyle="bold"
        android:layout_marginBottom="16dp" />

    <Button
        android:id="@+id/btnCapture"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="æ•è·å±å¹•"
        android:layout_marginBottom="16dp" />

    <TextView
        android:id="@+id/tvStatus"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="å‡†å¤‡å°±ç»ª"
        android:layout_marginBottom="16dp" />

    <ImageView
        android:id="@+id/ivScreenshot"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="1"
        android:scaleType="fitCenter"
        android:background="#f0f0f0" />

</LinearLayout>
```

## å››ã€æµ‹è¯•

1. **è¿è¡Œé¡¹ç›®**
   - è¿æ¥æ‰‹æœº
   - ç‚¹å‡»è¿è¡ŒæŒ‰é’®
   - ç­‰å¾…å®‰è£…å®Œæˆ

2. **æµ‹è¯•åŠŸèƒ½**
   - ç‚¹å‡»"æ•è·å±å¹•"æŒ‰é’®
   - æˆäºˆå±å¹•æ•è·æƒé™
   - æŸ¥çœ‹çŠ¶æ€æç¤º

## äº”ã€ä¸‹ä¸€æ­¥

å®Œæˆè¿™ä¸ªåŸºç¡€ç‰ˆæœ¬åï¼Œæˆ‘ä»¬ä¸‹ä¸€æ­¥å°†å®ç°ï¼š
- å®Œæ•´çš„å±å¹•æ•è·åŠŸèƒ½ï¼ˆä½¿ç”¨ MediaProjectionï¼‰
- æ˜¾ç¤ºæ•è·çš„æˆªå›¾
- ä¿å­˜æˆªå›¾åˆ°æœ¬åœ°

## å…­ã€é‡åˆ°é—®é¢˜ï¼Ÿ

**å¸¸è§é—®é¢˜ï¼š**

1. **æƒé™è¢«æ‹’ç»**
   - æ£€æŸ¥ AndroidManifest.xml ä¸­çš„æƒé™å£°æ˜
   - åœ¨æ‰‹æœºè®¾ç½®ä¸­æ‰‹åŠ¨æˆäºˆæƒé™

2. **æ‰¾ä¸åˆ°æ–‡ä»¶**
   - æ£€æŸ¥å­˜å‚¨æƒé™æ˜¯å¦æˆäºˆ
   - Android 10+ éœ€è¦ç‰¹æ®Šå¤„ç†

3. **ç¼–è¯‘é”™è¯¯**
   - æ£€æŸ¥ Kotlin ç‰ˆæœ¬
   - æ£€æŸ¥ä¾èµ–é…ç½®

**éšæ—¶é—®æˆ‘ï¼Œæˆ‘ä¼šå¸®ä½ è§£å†³ï¼**

---

**å®Œæˆè¿™ä¸ªåŠŸèƒ½åï¼Œå‘Šè¯‰æˆ‘ï¼Œæˆ‘ä»¬ç»§ç»­ä¸‹ä¸€æ­¥ï¼** ğŸ‰

